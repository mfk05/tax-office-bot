<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŒå€‰æ”¯éƒ¨ Google Workspace å°å…¥ã«ãªã‚“ã§ã‚‚ç­”ãˆã¾ã™</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
            color: white;
            padding: 32px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, transparent 70%);
            animation: shimmer 20s linear infinite;
        }

        @keyframes shimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .status-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4ade80;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .chat-container {
            height: 500px;
            overflow-y: auto;
            padding: 24px;
            background: #fafbfc;
            scroll-behavior: smooth;
        }

        .message {
            margin-bottom: 24px;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(12px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            display: flex;
            justify-content: flex-end;
        }

        .bot-message {
            display: flex;
            justify-content: flex-start;
            align-items: flex-start;
            gap: 12px;
        }

        .bot-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            flex-shrink: 0;
            overflow: hidden;
            background: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            line-height: 1;
        }

        .bot-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .bot-avatar.text-avatar {
            background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .message-content {
            max-width: 70%;
            padding: 16px 20px;
            border-radius: 20px;
            word-wrap: break-word;
            line-height: 1.6;
        }

        .user-message .message-content {
            background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
            color: white;
            border-bottom-right-radius: 6px;
        }

        .bot-message .message-content {
            background: white;
            border: 1px solid #e5e7eb;
            border-bottom-left-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .bot-message .message-content h3 {
            color: #1a365d;
            margin-bottom: 12px;
            margin-top: 16px;
            font-size: 18px;
            font-weight: 600;
        }

        .bot-message .message-content h3:first-child {
            margin-top: 0;
        }

        .bot-message .message-content ul {
            list-style: none;
            padding-left: 0;
            margin: 12px 0;
        }

        .bot-message .message-content ol {
            padding-left: 20px;
            margin: 12px 0;
        }

        .bot-message .message-content li {
            padding: 8px 0;
            padding-left: 24px;
            position: relative;
            line-height: 1.6;
        }

        .bot-message .message-content ul li:before {
            content: "â€¢";
            position: absolute;
            left: 0;
            color: #1a365d;
            font-weight: bold;
            font-size: 20px;
            line-height: 1;
            top: 8px;
        }

        .bot-message .message-content p {
            margin: 8px 0;
            line-height: 1.8;
        }

        .bot-message .message-content code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }

        .highlight {
            background: #fef3c7;
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: 500;
        }

        .code-block {
            background: #f3f4f6;
            padding: 16px;
            border-radius: 8px;
            margin: 12px 0;
            font-family: monospace;
            font-size: 14px;
            overflow-x: auto;
            white-space: pre-wrap;
            line-height: 1.5;
        }

        .input-container {
            padding: 24px;
            background: white;
            border-top: 1px solid #e5e7eb;
        }

        .input-wrapper {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .message-input {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 28px;
            font-size: 16px;
            transition: all 0.3s;
            background: #f9fafb;
        }

        .message-input:focus {
            outline: none;
            border-color: #1a365d;
            background: white;
        }

        .send-button {
            padding: 16px 32px;
            background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
            color: white;
            border: none;
            border-radius: 28px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 54, 93, 0.3);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .quick-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        .quick-button {
            padding: 8px 16px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-button:hover {
            background: #1a365d;
            color: white;
            border-color: #1a365d;
            transform: translateY(-1px);
        }

        .typing-indicator {
            display: none;
            padding: 16px 20px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 20px;
            border-bottom-left-radius: 6px;
            width: 90px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            margin-left: 48px;
        }

        .typing-indicator span {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #6b7280;
            margin: 0 3px;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-15px);
                opacity: 1;
            }
        }

        .error-message {
            background: #fee;
            color: #dc2626;
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
            font-size: 14px;
        }

        .info-message {
            background: #e0f2fe;
            color: #075985;
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
            font-size: 14px;
        }

        @media (max-width: 640px) {
            .container {
                max-width: 100%;
                border-radius: 0;
            }
            
            .header {
                padding: 24px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .status-indicator {
                position: static;
                margin-top: 16px;
                background: rgba(255, 255, 255, 0.15);
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .quick-buttons {
                gap: 6px;
            }
            
            .quick-button {
                font-size: 12px;
                padding: 6px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤–  Google Workspaceã®è³ªå•ã«ã ã„ãŸã„ãŠå¿œãˆã—ã¾ã™</h1>
            <div class="status-indicator">
                <span class="status-dot"></span>
                <span>AIãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ¼ãƒ‰</span>
            </div>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="message bot-message">
                <div class="bot-avatar" style="background: #f3f4f6; font-size: 24px;">ğŸ¤–</div>
                <div class="message-content">
                    <h3>ã“ã‚“ã«ã¡ã¯ï¼éŒå€‰æ”¯éƒ¨ã®24æ™‚é–“ç­”ãˆã‚‹ãã‚“ã§ã™</h3>
                    Google Workspaceå°å…¥ã«é–¢ã™ã‚‹ã”è³ªå•ã‚’ãŠæ°—è»½ã«ã©ã†ãã€‚<br><br>
                    <strong>ã‚ˆãã‚ã‚‹ã”è³ªå•ï¼šé€ä¿¡ãƒœã‚¿ãƒ³ã®ä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã§ãã‚‹ã‚ˆ</strong>
                    <ul>
                        <li>åˆ©ç”¨é–‹å§‹æ™‚æœŸã«ã¤ã„ã¦</li>
                        <li>è²»ç”¨ãƒ»å¥‘ç´„ã«ã¤ã„ã¦</li>
                        <li>å¹¹äº‹äº¤ä»£æ™‚ã®æ‰‹ç¶šã</li>
                        <li>ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã®ä»•çµ„ã¿</li>
                        <li>ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒæ–¹æ³•</li>
                        <li>ç®¡ç†ã•ã‚Œã‚‹éƒ¨ç½²ã«ã¤ã„ã¦</li>
                    </ul>
                    <br>
                    <div class="info-message">
                        ğŸ’¡ åŸºæœ¬çš„ãªè³ªå•ã«ã¯å³åº§ã«å›ç­”ã—ã€è©³ã—ã„æƒ…å ±ãŒå¿…è¦ãªå ´åˆã¯AIãŒè‡ªå‹•çš„ã«å¯¾å¿œã—ã¾ã™ã€‚
                    </div>
                </div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <span></span>
            <span></span>
            <span></span>
        </div>

        <div class="input-container">
            <div class="input-wrapper">
                <input type="text" id="messageInput" class="message-input" 
                       placeholder="è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." 
                       onkeypress="handleKeyPress(event)">
                <button class="send-button" id="sendButton" onclick="sendMessage()">
                    é€ä¿¡
                </button>
            </div>
            <div class="quick-buttons">
                <button class="quick-button" onclick="sendQuickMessage('ã„ã¤ã‹ã‚‰ä½¿ãˆã¾ã™ã‹ï¼Ÿ')">åˆ©ç”¨é–‹å§‹æ™‚æœŸ</button>
                <button class="quick-button" onclick="sendQuickMessage('è²»ç”¨ã¯ã„ãã‚‰ã§ã™ã‹ï¼Ÿ')">è²»ç”¨ã«ã¤ã„ã¦</button>
                <button class="quick-button" onclick="sendQuickMessage('å¹¹äº‹äº¤ä»£æ™‚ã®æ‰‹ç¶šãã¯ï¼Ÿ')">å¹¹äº‹äº¤ä»£</button>
                <button class="quick-button" onclick="sendQuickMessage('ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã«ã¤ã„ã¦æ•™ãˆã¦')">æ¨©é™è¨­å®š</button>
                <button class="quick-button" onclick="sendQuickMessage('ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ã—ã¾ã£ãŸ')">ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ</button>
                <button class="quick-button" onclick="sendQuickMessage('ç®¡ç†ã•ã‚Œã‚‹éƒ¨ç½²ã¯ï¼Ÿ')">éƒ¨ç½²ä¸€è¦§</button>
            </div>
        </div>
    </div>

    <!-- Marked.js ã‚’ CDN ã‹ã‚‰èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        const API_ENDPOINT = 'https://script.google.com/macros/s/AKfycbz-UqS1FqXVAkhdczquConGBDRra-NJb5s5Th1Rfs_JPE1ufN43GMrxxUZ_CKHuEqE/exec';
        const AI_AVATAR_URL = ''; // ç”»åƒURLã¾ãŸã¯ç©ºæ–‡å­—
        const AI_AVATAR_EMOJI = 'ğŸ¤–'; // ä½¿ç”¨ã™ã‚‹çµµæ–‡å­—
        
        // ãƒ­ãƒ¼ã‚«ãƒ«çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç‰ˆç”¨ï¼‰
        const knowledgeBase = {
            startDate: {
                keywords: ['ã„ã¤ã‹ã‚‰', 'åˆ©ç”¨é–‹å§‹', 'é–‹å§‹æ™‚æœŸ', 'ã„ã¤ä½¿ãˆã‚‹'],
                response: `<h3>åˆ©ç”¨é–‹å§‹æ™‚æœŸã«ã¤ã„ã¦</h3>
                2025å¹´ç§‹ä»¥é™ã€æ‹…å½“è€…ã«ã‚ˆã‚‹åˆæœŸè¨­å®šï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆã‚„ãƒ•ã‚©ãƒ«ãƒ€è¨­å®šãªã©ï¼‰ãŒå®Œäº†æ¬¡ç¬¬ã€åˆ©ç”¨é–‹å§‹ã®ã”æ¡ˆå†…ã‚’ã„ãŸã—ã¾ã™ã€‚<br><br>
                æ­£å¼ãªé–‹å§‹æ™‚æœŸã«ã¤ã„ã¦ã¯ã€æ”¹ã‚ã¦ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚`
            },
            email: {
                keywords: ['ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹', 'gmail', 'æ‹›å¾…', 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ'],
                response: `<h3>æ‹›å¾…ã•ã‚Œã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã¤ã„ã¦</h3>
                Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã‚ã‚Œã°ã€ã©ã®ã‚ˆã†ãªã‚‚ã®ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ï¼š
                <ul>
                <li>xxxx@gmail.com ã®ã‚ˆã†ãªGmailã‚¢ãƒ‰ãƒ¬ã‚¹</li>
                <li>ãƒ—ãƒ­ãƒã‚¤ãƒ€ã‚„å‹¤å‹™å…ˆã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã€Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ãŸã‚‚ã®</li>
                </ul>
                æ‹›å¾…ã‚’ã”å¸Œæœ›ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ‹…å½“è€…ã¾ã§ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚`
            },
            transition: {
                keywords: ['å¹¹äº‹äº¤ä»£', 'é€€ä»»', 'å¼•ãç¶™ã', 'äº¤ä»£æ™‚'],
                response: `<h3>å¹¹äº‹äº¤ä»£æ™‚ã®æ‰‹ç¶šãã«ã¤ã„ã¦</h3>
                <span class="highlight">é€€ä»»ã•ã‚Œã‚‹æ–¹ã®ä½œæ¥­ã¯ç‰¹ã«å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚</span><br><br>
                äº‹å‹™å±€ãŒã€çš†æ§˜ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’ä¸€æ‹¬ã§è§£é™¤ã—ã¾ã™ã€‚<br><br>
                ãŸã ã—ã€ã”è‡ªèº«ã®æ‹…å½“æ¥­å‹™ã«é–¢ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒã€ã™ã¹ã¦æ¼ã‚Œãªãå…±æœ‰ãƒ‰ãƒ©ã‚¤ãƒ–ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã®ã”ç¢ºèªã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚`
            },
            deletion: {
                keywords: ['å‰Šé™¤', 'ã‚´ãƒŸç®±', 'å¾©å…ƒ', 'æ¶ˆã—ã¦ã—ã¾ã£ãŸ', 'ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ'],
                response: `<h3>ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ã—ã¾ã£ãŸå ´åˆ</h3>
                ã”å®‰å¿ƒãã ã•ã„ã€‚å¾©å…ƒã§ãã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ï¼š
                <ul>
                <li>ã¾ãšã€ã”è‡ªèº«ã®ã€Œã‚´ãƒŸç®±ã€ã‚’ç¢ºèªã—ã¦ãã ã•ã„</li>
                <li>å‰Šé™¤ã‹ã‚‰30æ—¥ä»¥å†…ã§ã‚ã‚Œã°ã€ã”è‡ªèº«ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã®å ´æ‰€ã«æˆ»ã›ã¾ã™</li>
                <li>ã‚´ãƒŸç®±ã‹ã‚‰ã‚‚å‰Šé™¤ã—ã¦ã—ã¾ã£ãŸå ´åˆã§ã‚‚ã€äº‹å‹™å±€ã«ã”é€£çµ¡ã„ãŸã ã‘ã‚Œã°ã€<span class="highlight">å‰Šé™¤å¾Œ25æ—¥ä»¥å†…ã§ã‚ã‚Œã°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¾©å…ƒã§ãã¾ã™</span></li>
                </ul>
                ã“ã‚Œã¯æœ‰æ–™ãƒ—ãƒ©ãƒ³ã®å¼·ã¿ã§ã™ã€‚`
            },
            cost: {
                keywords: ['è²»ç”¨', 'æ–™é‡‘', 'ã„ãã‚‰', 'ã‚³ã‚¹ãƒˆ', 'äºˆç®—'],
                response: `<h3>è²»ç”¨ã«ã¤ã„ã¦</h3>
                å¹´é–“è²»ç”¨ï¼š<span class="highlight">38,400å††ï¼ˆç¨æŠœï¼‰</span><br><br>
                å†…è¨³ï¼š
                <ul>
                <li>1,600å††/æœˆ Ã— 2ID Ã— 12ãƒ¶æœˆ</li>
                <li>å¥‘ç´„IDï¼šäº‹å‹™å±€ID ã¨ æ”¯éƒ¨é•·ID ã®2ã¤ã®ã¿</li>
                </ul>
                å„å¹¹äº‹ï¼ˆç´„30åï¼‰ã¯å€‹äººã®Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§æ‹›å¾…ã•ã‚Œã‚‹å½¢ãªã®ã§ã€è¿½åŠ è²»ç”¨ã¯ã‹ã‹ã‚Šã¾ã›ã‚“ã€‚`
            },
            mobile: {
                keywords: ['ã‚¹ãƒãƒ›', 'ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³', 'ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ', 'ã‚¢ãƒ—ãƒª', 'ãƒ¢ãƒã‚¤ãƒ«'],
                response: `<h3>ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã§ã®åˆ©ç”¨</h3>
                ã¯ã„ã€åˆ©ç”¨å¯èƒ½ã§ã™ï¼š
                <ul>
                <li>ãŠä½¿ã„ã®ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚„ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã«ã€ŒGoogleãƒ‰ãƒ©ã‚¤ãƒ–ã€ã®ã‚¢ãƒ—ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</li>
                <li>æ‹›å¾…ã•ã‚ŒãŸGoogleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³</li>
                <li>PCã¨åŒã˜ã‚ˆã†ã«ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™</li>
                </ul>`
            },
            permission: {
                keywords: ['æ¨©é™', 'ã‚¢ã‚¯ã‚»ã‚¹æ¨©', 'è¦‹ãˆãªã„', 'ãƒ•ã‚©ãƒ«ãƒ€', 'é–²è¦§'],
                response: `<h3>ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã®ä»•çµ„ã¿</h3>
                å½¹è·ã«å¿œã˜ãŸæ¨©é™è¨­å®šï¼š
                <ul>
                <li><strong>éƒ¨é•·</strong>ï¼šå…¨éƒ¨ç½²ã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’é–²è¦§å¯èƒ½ã€è‡ªéƒ¨ç½²ã¯ç·¨é›†ã‚‚å¯èƒ½</li>
                <li><strong>å‰¯éƒ¨é•·</strong>ï¼šè‡ªéƒ¨ç½²ã®ãƒ•ã‚©ãƒ«ãƒ€ã®ã¿ç·¨é›†å¯èƒ½</li>
                <li><strong>å‰¯æ”¯éƒ¨é•·</strong>ï¼šäº‹å‹™å±€ç®¡ç†ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½</li>
                </ul>
                ãƒ•ã‚©ãƒ«ãƒ€ãŒè¦‹ãˆãªã„å ´åˆã¯ã€æ‹…å½“è€…ã¾ã§ã”é€£çµ¡ãã ã•ã„ã€‚`
            },
            departments: {
                keywords: ['éƒ¨ç½²', 'ç®¡ç†ã•ã‚Œã‚‹éƒ¨ç½²', 'çµ„ç¹”', 'éƒ¨é–€'],
                response: `<h3>ç®¡ç†ã•ã‚Œã‚‹éƒ¨ç½²ä¸€è¦§</h3>
                Google Workspaceã§ç®¡ç†ã•ã‚Œã‚‹11éƒ¨ç½²ï¼š
                <ul>
                <li>ç·å‹™éƒ¨</li>
                <li>ç¶±ç´€ç›£å¯Ÿéƒ¨</li>
                <li>æ¥­å‹™ç ”ç©¶éƒ¨</li>
                <li>åºƒå ±éƒ¨</li>
                <li>åšç”Ÿéƒ¨</li>
                <li>ç¨å‹™æ”¯æ´å¯¾ç­–éƒ¨</li>
                <li>ç¨å‹™ç›¸è«‡éƒ¨</li>
                <li>ç§Ÿç¨æ•™è‚²éƒ¨</li>
                <li>çµŒç†éƒ¨</li>
                <li>æˆå¹´å¾Œè¦‹æ”¯æ´ã‚»ãƒ³ã‚¿ãƒ¼</li>
                <li>éŒå€‰æ”¯éƒ¨å‰µç«‹40å‘¨å¹´è¨˜å¿µå§”å“¡ä¼š</li>
                </ul>
                ã“ã®ä»–ã«ã€Œäº‹å‹™å±€ç®¡ç†ã€ãƒ•ã‚©ãƒ«ãƒ€ãŒã‚ã‚Šã¾ã™ã€‚`
            }
        };

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
        document.addEventListener('DOMContentLoaded', function() {
            // marked.js ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
            if (typeof marked === 'undefined') {
                console.error('marked.js ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
            } else {
                console.log('marked.js ãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
                // marked.js ã®å‹•ä½œç¢ºèª
                try {
                    const testResult = marked.parse('**test**');
                    if (testResult.includes('<strong>')) {
                        console.log('marked.js ã®å‹•ä½œç¢ºèª: OK');
                    }
                } catch (e) {
                    console.error('marked.js ã®å‹•ä½œç¢ºèªä¸­ã«ã‚¨ãƒ©ãƒ¼:', e);
                }
            }
            
            // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¢ãƒã‚¿ãƒ¼ã‚’æ›´æ–°ï¼ˆç”»åƒURLãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
            if (AI_AVATAR_URL) {
                const initialAvatar = document.querySelector('.chat-container .bot-avatar');
                if (initialAvatar) {
                    updateAvatar(initialAvatar);
                }
            }
        });

        function updateAvatar(avatarDiv) {
            if (AI_AVATAR_URL) {
                const img = document.createElement('img');
                img.src = AI_AVATAR_URL;
                img.alt = 'AI Assistant';
                img.onerror = function() {
                    avatarDiv.innerHTML = AI_AVATAR_EMOJI;
                    avatarDiv.style.background = '#f3f4f6';
                    avatarDiv.style.fontSize = '24px';
                };
                avatarDiv.innerHTML = '';
                avatarDiv.appendChild(img);
            } else {
                avatarDiv.textContent = AI_AVATAR_EMOJI;
                avatarDiv.style.background = '#f3f4f6';
                avatarDiv.style.fontSize = '24px';
            }
        }
        
        function updateStatus() {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            if (apiEndpoint) {
                statusDot.classList.remove('offline');
                statusText.textContent = 'ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ¼ãƒ‰ï¼ˆAIæœ‰åŠ¹ï¼‰';
            } else {
                statusDot.classList.add('offline');
                statusText.textContent = 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰';
            }
        }

        function toggleConfig() {
            const panel = document.getElementById('configPanel');
            panel.classList.toggle('active');
        }

        function saveConfig() {
            apiEndpoint = document.getElementById('apiEndpoint').value.trim();
            localStorage.setItem('apiEndpoint', apiEndpoint);
            updateStatus();
            toggleConfig();
            
            if (apiEndpoint) {
                addMessage('AIæ©Ÿèƒ½ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸã€‚ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç‰ˆã§å¯¾å¿œã§ããªã„è³ªå•ã¯è‡ªå‹•çš„ã«AIãŒå›ç­”ã—ã¾ã™ã€‚', false);
            } else {
                addMessage('ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã«è¨­å®šã•ã‚Œã¾ã—ãŸã€‚', false);
            }
        }

        function findBestResponse(userMessage) {
            const lowerMessage = userMessage.toLowerCase();
            let bestMatch = null;
            let maxScore = 0;

            for (const [key, data] of Object.entries(knowledgeBase)) {
                let score = 0;
                for (const keyword of data.keywords) {
                    if (lowerMessage.includes(keyword)) {
                        score += keyword.length;
                    }
                }
                if (score > maxScore) {
                    maxScore = score;
                    bestMatch = data.response;
                }
            }

            if (bestMatch) {
                return bestMatch;
            }

            return `<h3>ãŠå•ã„åˆã‚ã›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™</h3>
            ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚ãã®è³ªå•ã«ã¤ã„ã¦ã¯è©³ã—ã„æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚<br><br>
            æ‹…å½“è€…ã¾ã§ãŠå•ã„åˆã‚ã›ã„ãŸã ãã‹ã€ä»¥ä¸‹ã®ã‚ˆã†ãªè³ªå•ã‚’ãŠè©¦ã—ãã ã•ã„ï¼š
            <ul>
            <li>åˆ©ç”¨é–‹å§‹æ™‚æœŸã«ã¤ã„ã¦</li>
            <li>è²»ç”¨ã«ã¤ã„ã¦</li>
            <li>å¹¹äº‹äº¤ä»£æ™‚ã®æ‰‹ç¶šã</li>
            <li>ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã«ã¤ã„ã¦</li>
            </ul>`;
        }

        async function callClaudeAPI(message) {
            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify({
                        messages: [
                            {
                                role: 'user',
                                content: message
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Response:', errorText);
                    throw new Error(`APIå‘¼ã³å‡ºã—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${response.status}`);
                }

                const data = await response.json();
                
                // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å½¢å¼ã‚’ç¢ºèª
                if (data.error) {
                    throw new Error(data.error);
                }
                
                return data.response || data.content || 'ã‚¨ãƒ©ãƒ¼: å¿œç­”ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ';
            } catch (error) {
                console.error('API Call Error:', error);
                throw error;
            }
        }

        function addMessage(content, isUser, isRaw = false) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            
            if (!isUser) {
                const avatarDiv = document.createElement('div');
                avatarDiv.className = 'bot-avatar';
                updateAvatar(avatarDiv);
                messageDiv.appendChild(avatarDiv);
            }
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            if (isRaw) {
                contentDiv.textContent = content;
            } else {
                contentDiv.innerHTML = content;
            }
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function showTypingIndicator() {
            const chatContainer = document.getElementById('chatContainer');
            const indicator = document.getElementById('typingIndicator');
            indicator.style.display = 'block';
            chatContainer.appendChild(indicator);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            indicator.style.display = 'none';
        }

        // marked.js ã®è¨­å®š
        if (typeof marked !== 'undefined') {
            // marked.js v4.0ä»¥é™ã¨ãã‚Œä»¥å‰ã®ä¸¡æ–¹ã«å¯¾å¿œ
            try {
                marked.setOptions({
                    breaks: true, // æ”¹è¡Œã‚’<br>ã«å¤‰æ›
                    gfm: true, // GitHub Flavored Markdown ã‚’æœ‰åŠ¹åŒ–
                    headerIds: false, // ãƒ˜ãƒƒãƒ€ãƒ¼ã«IDã‚’ä»˜ã‘ãªã„
                    mangle: false, // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’é›£èª­åŒ–ã—ãªã„
                });
            } catch (e) {
                console.log('marked.js ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®šæ™‚ã®è­¦å‘Š:', e.message);
                // å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å ´åˆã‚„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ç„¡è¦–
            }
        }

        function convertMarkdownToHTML(text) {
            try {
                // marked.js ãŒåˆ©ç”¨å¯èƒ½ã‹ç¢ºèª
                if (typeof marked === 'undefined' || typeof marked.parse !== 'function') {
                    throw new Error('marked.js ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
                
                // marked.js ã‚’ä½¿ç”¨ã—ã¦ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚’å¤‰æ›
                let html = marked.parse(text);
                
                // è¿½åŠ ã®å‡¦ç†
                // h1, h2ã‚¿ã‚°ã‚’h3ã«çµ±ä¸€ï¼ˆãƒ‡ã‚¶ã‚¤ãƒ³ã®ä¸€è²«æ€§ã®ãŸã‚ï¼‰
                html = html.replace(/<h1>/g, '<h3>').replace(/<\/h1>/g, '</h3>');
                html = html.replace(/<h2>/g, '<h3>').replace(/<\/h2>/g, '</h3>');
                
                // highlight ã‚¯ãƒ©ã‚¹ã®é©ç”¨ï¼ˆç‰¹å®šã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç”¨ï¼‰
                const highlightKeywords = [
                    'å‰Šé™¤å¾Œ25æ—¥ä»¥å†…',
                    '38,400å††ï¼ˆç¨æŠœï¼‰',
                    'é€€ä»»ã•ã‚Œã‚‹æ–¹ã®ä½œæ¥­ã¯ç‰¹ã«å¿…è¦ã‚ã‚Šã¾ã›ã‚“',
                    '2025å¹´ç§‹ä»¥é™'
                ];
                
                highlightKeywords.forEach(keyword => {
                    const regex = new RegExp(`(${keyword})`, 'g');
                    html = html.replace(regex, '<span class="highlight">$1</span>');
                });
                
                // ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã«ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
                html = html.replace(/<pre><code>/g, '<pre class="code-block"><code>');
                
                return html;
            } catch (error) {
                console.error('Markdown conversion error:', error);
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯åŸºæœ¬çš„ãªã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã‚’è¡Œã£ã¦è¿”ã™
                return text
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/\n/g, '<br>')
                    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.+?)\*/g, '<em>$1</em>')
                    .replace(/`(.+?)`/g, '<code>$1</code>');
            }
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            const sendButton = document.getElementById('sendButton');
            
            if (!message) return;
            
            addMessage(message, true);
            input.value = '';
            sendButton.disabled = true;
            
            showTypingIndicator();
            
            try {
                // ã¾ãšã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç‰ˆã§æ¤œç´¢
                await new Promise(resolve => setTimeout(resolve, 500));
                const offlineResponse = findBestResponse(message);
                
                // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç‰ˆã§é©åˆ‡ãªå›ç­”ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®ã¿APIã‚’ä½¿ç”¨
                const needsAI = offlineResponse.includes('ãã®è³ªå•ã«ã¤ã„ã¦ã¯è©³ã—ã„æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
                
                if (needsAI) {
                    // AIæ¤œç´¢ä¸­ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
                    hideTypingIndicator();
                    addMessage('<div class="info-message">ğŸ“š è©³ã—ã„æƒ…å ±ã‚’æ¤œç´¢ä¸­ã§ã™...</div>', false);
                    showTypingIndicator();
                    
                    try {
                        const aiResponse = await callClaudeAPI(message);
                        hideTypingIndicator();
                        const formattedResponse = convertMarkdownToHTML(aiResponse);
                        addMessage(formattedResponse, false);
                    } catch (apiError) {
                        console.error('API Error:', apiError);
                        hideTypingIndicator();
                        addMessage(`<div class="error-message">AIã«ã‚ˆã‚‹å›ç­”ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${apiError.message}</div>${offlineResponse}`, false);
                    }
                } else {
                    hideTypingIndicator();
                    addMessage(offlineResponse, false);
                }
            } catch (error) {
                console.error('Send Message Error:', error);
                hideTypingIndicator();
                addMessage(`<div class="error-message">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}</div>`, false);
            } finally {
                sendButton.disabled = false;
            }
        }

        function sendQuickMessage(message) {
            const input = document.getElementById('messageInput');
            input.value = message;
            sendMessage();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // å‰Šé™¤ã•ã‚ŒãŸé–¢æ•°ã¨UIè¦ç´ 
        // updateStatus(), toggleConfig(), saveConfig() ã¯ä¸è¦ã«ãªã‚Šã¾ã—ãŸ
        
        // ãƒ‡ãƒãƒƒã‚°é–¢æ•°
        async function testAPI() {
            try {
                const response = await fetch(API_ENDPOINT);
                const data = await response.json();
                console.log('API Test Result:', data);
            } catch (error) {
                console.error('API Test Error:', error);
            }
        }
        
        // ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å¤‰æ›ã®ãƒ†ã‚¹ãƒˆ
        function testMarkdownConversion() {
            const testCases = [
                '# è¦‹å‡ºã—1\n## è¦‹å‡ºã—2\n### è¦‹å‡ºã—3',
                '**å¤ªå­—**ã¨*æ–œä½“*ã®ãƒ†ã‚¹ãƒˆ',
                '- ãƒªã‚¹ãƒˆé …ç›®1\n- ãƒªã‚¹ãƒˆé …ç›®2\n- ãƒªã‚¹ãƒˆé …ç›®3',
                '1. ç•ªå·ä»˜ã1\n2. ç•ªå·ä»˜ã2',
                'ã“ã‚Œã¯`ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰`ã§ã™',
                '<li>ã“ã‚Œã¯HTMLã‚¿ã‚°ã§ã™</li>',
                '```javascript\nfunction test() {\n  console.log("Hello");\n}\n```'
            ];
            
            if (typeof marked === 'undefined') {
                console.error('marked.js ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            testCases.forEach((test, index) => {
                console.log(`Test ${index + 1}:`);
                console.log('Input:', test);
                console.log('Output:', convertMarkdownToHTML(test));
                console.log('---');
            });
        }
    </script>
</body>
</html>
